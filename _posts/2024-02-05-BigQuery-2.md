---
layout: post
title: BigQuery 쿼리 필수 요소 (정리중)
subtitle: 도서 구글 빅쿼리 완벽 가이드 스터디
author: san9hyun
categories: BigQuery
banner : /assets/images/banners/squirrel.jpg
tags: BigQuery 빅쿼리
---


> 🧑 도서 [발리아파 락쉬마난,조던 티가니 "구글 빅쿼리 완벽 가이드" O’Reilly]를 개인적으로 공부한 것입니다.

## 쿼리 필수 요소 정리

### 1.WITH 절 

> ⛳️ 빅쿼리에서 WITH 구문은 임시 테이블을 생성하지 않는다!

```
SELECT * FROM (
  SELECT
    gender, tripduration / 60 AS minutes
  FROM
    `bigquery-public-data`.new_york_citibike.citibike_trips
)

WHERE minutes < 10 -- 바깥쪽의 SELECT는 안쪽의 서브 쿼리의 결과를 참조하기 때문에, 서브쿼리가 사용한 별칭을 WHERE절에도 사용 가능하다.
LIMIT 5   
```

위와 같은 서브쿼리 대신 WITH절을 사용할 수 있다. <br>
WITH절을 사용하면 가독성이 높아지고, 재사용 가능하다는 장점이 있다.<br>

```
WITH all_trips AS (
  SELECT
    gender, tripduration / 60 AS minutes
  FROM
    `bigquery-public-data`.new_york_citibike.citibike_trips
)

SELECT * FROM all_trips
WHERE minutes < 10 
LIMIT 5   
```

일반적으로 사용하는 많은 DB들이 위와 같은 WITH 구문을 지원한다.
그런데 WITH 구문는 가상의 테이블을 생성하여 메모리에 할당하기 떄문에 성능 문제가 발생할수도 있다.

하지만, 
빅쿼리에서 WITH 구문은 이름이 있는 서브쿼리 처럼 작동하며 임시 테이블을 생성하지 않기 때문에(p62)<br>
성능이슈를 크게 걱정하지 않아도 된다고 한다.

